name: Build and Deploy ERP API
on:
  push:
    branches: [ main,master ]

jobs:
  deploy:
    permissions:
      contents: read
    uses: codevertex/devops-k8s/.github/workflows/reusable-build-deploy.yml@main
    with:
      app_name: erp-api
      registry_server: docker.io
      registry_namespace: codevertex
      values_file_path: apps/erp-api/values.yaml
      deploy: ${{ github.ref == 'refs/heads/main' || github.ref == 'refs/heads/master' }}
      namespace: erp
      ssh_deploy: false
      setup_databases: true
      db_types: postgres,redis
      env_secret_name: erp-api-env
      provider: contabo
      contabo_api: true
    secrets:
      REGISTRY_USERNAME: ${{ secrets.REGISTRY_USERNAME }}
      REGISTRY_PASSWORD: ${{ secrets.REGISTRY_PASSWORD }}
      KUBE_CONFIG: ${{ secrets.KUBE_CONFIG }}


